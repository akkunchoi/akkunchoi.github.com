<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Akkunchoi.github.com : " />

    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/stylesheet.css">

    <title>Rails3 routes.rb まとめ | akkunchoi@github</title>
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for mysite.com" href="/feed.xml" />
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/akkunchoi">View on GitHub</a>

          <h1 id="project_title">
            <a href="/">akkunchoi.github.com</a>
          </h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

      <article class="posts">
  <header>
    <h1>Rails3 routes.rb まとめ</h1>
    <ul class="tags">
      
      <li class="inline archive_list"><a class="tag_list_link" href="/tag/ruby">ruby</a></li>
      
      <li class="inline archive_list"><a class="tag_list_link" href="/tag/rails">rails</a></li>
      
    </ul>
  </header>
  <div class="posts-content">
  <ul id="markdown-toc">
  <li><a href="#basics">Basics</a></li>
  <li><a href="#resources">Resources</a>    <ul>
      <li><a href="#namespace">Namespace</a></li>
      <li><a href="#scope-controller">Scope (Controller)</a></li>
      <li><a href="#scope-path">Scope (Path)</a></li>
      <li><a href="#nested-resources">Nested Resources</a></li>
      <li><a href="#member">member</a></li>
      <li><a href="#collection">collection</a></li>
    </ul>
  </li>
  <li><a href="#non-resourceful">Non-Resourceful</a>    <ul>
      <li><a href="#dynamic">dynamic</a></li>
      <li><a href="#static">static</a></li>
      <li><a href="#defaults">defaults</a></li>
      <li><a href="#named">named</a></li>
      <li><a href="#glob">glob</a></li>
      <li><a href="#redirection">redirection</a></li>
      <li><a href="#root">root</a></li>
    </ul>
  </li>
  <li><a href="#customized-resource">Customized Resource</a></li>
  <li><a href="#section">こんなこともできました</a>    <ul>
      <li><a href="#resourcesmatch">resourcesでmatchを使う</a></li>
    </ul>
  </li>
  <li><a href="#section-1">参考</a></li>
</ul>

<h2 id="basics">Basics</h2>

<p>ルーティングとはURLとコントローラー、アクションとのマッピング。
Railsでは<code>config/routes.rb</code>にDSLで記述する。
Rails2とRails3ではかなり書き方が変わっている。</p>

<p><code>resources</code>を上手く使うのがコツのようだ。
<code>resources</code>を使うとリソース（って何なんだという話だけど）のCRUD（Create, Read, Update, Delete）を行うルーティングが生成される。これを使うと一貫性があり、記述量を減らすことができる。</p>

<p><a href="http://guides.rubyonrails.org/routing.html">公式のガイド</a>に沿って、まずは最もシンプルな例を試してみる。</p>

<pre><code># -- config/routes.rb

match "/patients/:id" =&gt; "patients#show"
</code></pre>

<p>この一行で<strong>/patients/17 に HTTP GET すると、PatientsController の show アクションが呼ばれる</strong>という設定になる。</p>

<p>また、ビューで<code>patient_path(patient_id)</code>するとURL生成のヘルパーが使用できる(named_helperと言うらしい)
_path ではなく _url にすると、host, port, path_prefix が付いたURLが生成できる。</p>

<p><code>rake routes</code>を実行すると、ルーティングの設定が確認できる。
named_helperを<code>rails console</code>で試す場合は<code>app.users_path</code>で呼び出すことができる。</p>

<p>以上で基本終わり。以降設定の詳細を見ていく。</p>

<p>TODO named_helper生成の仕組み</p>

<h2 id="resources">Resources</h2>

<pre><code>#
# HTTP Verb  Path             action  named_helper 
# ---------  -----            ------  ----------
# GET        /photos          index   photos_path 
# GET        /photos/new      new     new_photo_path
# POST       /photos          crete   photos_path
# GET        /photos/:id      show    photo_path(:id)
# GET        /photos/:id/edit edit    edit_photo_path(:id)
# PUT        /photos/:id      update  photo_path(:id)
# DELETE     /photos/:id      destroy photo_path(:id)

resources :photos
</code></pre>

<h3 id="namespace">Namespace</h3>

<p>namespaceはpathとcontrollerに付けられるprefix</p>

<pre><code># HTTP Verb  Path               action  named_helper 
# ---------  -----              ------  ----------
# GET        /admin/photos      index   admin_photos_path 
# GET        /admin/photos/new  new     new_admin_photo_path
#   省略...
# 

namespace :admin do
  resources :photos
end
</code></pre>

<h3 id="scope-controller">Scope (Controller)</h3>

<p>controllerのみprefix</p>

<pre><code># HTTP Verb  Path         action  named_helper 
# ---------  -----        ------  ----------
# GET        /photos      index   photos_path 
# GET        /photos/new  new     new_photo_path
#   省略...
# 

scope :module =&gt; "admin" do
  resources :photos
end
</code></pre>

<p>または</p>

<pre><code>resources :photos, :module =&gt; "admin"
</code></pre>

<h3 id="scope-path">Scope (Path)</h3>

<p>pathのみprefixを付ける場合場合</p>

<pre><code># HTTP Verb  Path               action  named_helper 
# ---------  -----              ------  ----------
# GET        /admin/photos      index   photos_path 
# GET        /admin/photos/new  new     new_photo_path
#   省略...
# 

scope "/admin" do    
  resources :photos
end
</code></pre>

<p>または</p>

<pre><code>resources :photos, :path =&gt; '/admin/photos'
</code></pre>

<p><code>:path</code>を使えば自由にパスを変更できる</p>

<pre><code># GET  /hoge

resources :photos, :path =&gt; 'hoge' 
</code></pre>

<h3 id="nested-resources">Nested Resources</h3>

<pre><code>resources :photos do
  resources :comments
end 
</code></pre>

<p>TODO</p>

<h3 id="member">member</h3>

<pre><code># GET /photos/:id/preview

resources :photos do
  member do
    get 'preview'
  end
end

... or

resources :photos do
  get 'preview', :on =&gt; :member
end
</code></pre>

<h3 id="collection">collection</h3>

<pre><code># GET /photos/search

resources :photos do
  collection do
    get 'search'
  end
end

... or

resources :photos do
  get 'search', :on =&gt; :collection
end
</code></pre>

<h2 id="non-resourceful">Non-Resourceful</h2>

<h3 id="dynamic">dynamic</h3>

<pre><code>match ':controller(/:action(/:id))'

# GET /photos/show/1/2
# { :controller =&gt; “photos”, :action =&gt; “show”, :id =&gt; “1”, :user_id =&gt; “2” }
match ':controller/:action/:id/:user_id'

match ':controller(/:action(/:id))', :controller =&gt; /admin\/[^\/]+/
</code></pre>

<h3 id="static">static</h3>

<pre><code># GET /photos/show/1/with_user/2
# { :controller =&gt; “photos”, :action =&gt; “show”, :id =&gt; “1”, :user_id =&gt; “2” }
match ':controller/:action/:id/with_user/:user_id'
</code></pre>

<h3 id="defaults">defaults</h3>

<pre><code># GET /photos/1
# { :controller =&gt; "photos", :action =&gt; "show", :id =&gt; "1", :format =&gt; "jpg"
match 'photos/:id' =&gt; 'photos#show', :defaults =&gt; { :format =&gt; 'jpg' }
</code></pre>

<h3 id="named">named</h3>

<pre><code># logout_path, logout_url
match 'exit' =&gt; 'sessions#destroy', :as =&gt; :logout
</code></pre>

<p>TODO</p>

<ul>
  <li>:via</li>
  <li>:constraints</li>
  <li>:subdomain</li>
  <li>Advanced Constraints</li>
</ul>

<h3 id="glob">glob</h3>

<pre><code># GET /photos/12               :other =&gt; "12"
# GET /photos/long/path/to/12, :other =&gt; "long/path/to/12".
match 'photos/*other' =&gt; 'photos#unknown'
</code></pre>

<h3 id="redirection">redirection</h3>

<p>TODO</p>

<h3 id="root">root</h3>

<p>TODO</p>

<h2 id="customized-resource">Customized Resource</h2>

<p>TODO</p>

<h2 id="section">こんなこともできました</h2>

<h3 id="resourcesmatch">resourcesでmatchを使う</h3>

<pre><code>resources :users do
  member do
    match 'category/:category', :action =&gt; :show, :as =&gt; :category
  end
  resources :images do
    collection do
      match 'category/:category', :action =&gt; :index, :as =&gt; :category
    end
  end
end
</code></pre>

<p>$ rake routes</p>

<pre><code>category_user        /users/:id/category/:category(.:format)             users#show
category_user_images /users/:user_id/images/category/:category(.:format) images#index
</code></pre>

<h2 id="section-1">参考</h2>
<ul>
  <li><a href="http://guides.rubyonrails.org/routing.html">http://guides.rubyonrails.org/routing.html</a></li>
</ul>


  </div>
  <footer> 
  <p>Last updated at <time>2012-08-07 22:14:31 +0900</time></p>
  <!-- <p>Published at <time>2012-07-20</time></p> -->
  </footer>
</article>




      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31706657-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </body>
</html>
